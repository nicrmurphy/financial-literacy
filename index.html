<!DOCTYPE html>

<html>
  <head>

    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script> -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  </head>

  <body>
    <div>
    <label for="initial-investment">Initial Investment: </label>
    <input id="initial-investment" type="number" min="0" onchange="handleChange()"></input><br/>
    <label for="years">Years: </label>
    <input id="years" type="number" min="1" onchange="handleChange()"></input><br/>
    <label for="interest-rate">Interest Rate: </label>
    <input id="interest-rate" type="number" min="1" max="100" onchange="handleChange()"></input>%<br/>
    <br/>
    
    <label for="account-balance">Account Balance (Stale): </label>
    <input id="account-balance" type="number" disabled="true"></input>
    </div>
    
    
    <br/>
    <br/>
    Account Balance with yearly deposits of 100:<br/>
    <table>
      <tr>
        <th>Year</th>
        <th>Balance</th>
      </tr>
    </table>
    <div style="height: 200px; overflow: scroll" id="container">
      <table id="data-table">
      </table>
    </div>

    <canvas id="myChart" width="400" height="400"></canvas>
  </body>

</html>

<script>
  let lineChart

  const roundTo = n => {
    return Math.round((n + Number.EPSILON) * 10000) / 10000
  }

  let balanceOverTime = []

  // define min and max values
  const minInitialInvestment = 0
  const maxInitialInvestment = 1000000
  const minYears = 0
  const maxYears = 1000
  const minInterestRate = 0
  const maxInterestRate = 10000

  // define input variables
  let initialInvestment = 0
  let years = 0
  let interestRate = 0

  /**
   * Sets the variables to the most recent values from user input
   */
  const updateValues = () => {
    initialInvestment = parseInt($('#initial-investment').val())
    years = $('#years').val()
    interestRate = ($('#interest-rate').val() / 100) + 1 // as a percentage
  }

  const snapNumber = (n, min, max) => {
    return Math.min(Math.max(n, min), max)
  }

  /**
   * Snap input field to defined min and max constants
   */
  const snapValues = () => {
    if (initialInvestment < minInitialInvestment) {
      $('#initial-investment').val(minInitialInvestment)
    } else if (initialInvestment > maxInitialInvestment) {
      $('#initial-investment').val(maxInitialInvestment)
    }
    if (years < 0) {
      $('#years').val(0)
    }
    if (interestRate < 0) {
      $('#interest-rate').val(1)
    }
  }

  const calculateResult = () => {

    let result = Math.pow(interestRate, years) * initialInvestment
    $('#account-balance').val(roundTo(result))

    let deposit = 100
    let balance = interestRate * (initialInvestment + deposit)

    let balanceOverTime = []
    let labels = []
    $('#data-table').empty().append(`<tr><td>${1}</td><td>${roundTo(balance)}</td></tr>`)
    balanceOverTime.push(roundTo(balance))
    for (let year = 1; year < years; year++) {
      balance = (balance + deposit) * interestRate
      balanceOverTime.push(roundTo(balance))
      labels.push(year)
      $('#data-table').append(`<tr><td>${year + 1}</td><td>${roundTo(balance)}</td></tr>`)
    }

    lineChart.data.labels = labels
    lineChart.data.datasets[0].data = balanceOverTime
    lineChart.update()

  }

  const handleChange = () => {
    snapValues()
    updateValues()
    calculateResult()
  }

  // chart.js
  $(document).ready(() => {
    let ctx = $('#myChart')[0].getContext('2d')

    let data = {
      labels: [],
      datasets: [{
        label: 'Account Balance',
        data: [],
        backgroundColor: ['rgba(255, 99, 132, 0.2)'],
        borderWidth: 1
      }]
    }

    for (let i = 0; i < 100; i++) {
      data.labels.push(i + 1)
    }

    let options = {
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }
    }

    lineChart = new Chart(ctx, {
      type: 'line',
      data: data,
      options: options
    })
  })
</script>